# Async Thenable Compliance Tracking for ng-mocks Spies and Async Test Utilities

 As a developer writing Angular tests, I need a way to detect when a mock/spy returns a Promise-like thenable that settles **synchronously** (before the next microtask), because it can mask async boundary bugs and make tests misleading. For this feature, a thenable is **sync-settling** if its fulfillment/rejection handlers run before a callback scheduled for the *next* microtask turn would run (for example, if a handler runs immediately during the same call stack when `.then(...)` is attached), and it is **async-compliant** if it does not. Add an opt-in async compliance detector on ng-mocks spies/mocks that observes thenable returns and records per-call compliance (`true` = did not settle synchronously, `false` = settled synchronously) without changing the callâ€™s return value. The detector is enabled via `enableStrictAsyncCompliance()` (chainable). Recorded results are exposed via `getAsyncCompliance()` as an immutable snapshot (mutating the returned array must not throw and must not affect stored records). `resetAsyncCompliance()` clears recorded results while keeping tracking enabled. `restoreAsyncCompliance()` clears recorded results and disables tracking; while disabled, `getAsyncCompliance()` returns `[]`. Any global restore mechanism must also disable/clear async compliance tracking.


